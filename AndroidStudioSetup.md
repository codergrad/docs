## Установка и настройка Android Studio

Откровенно говоря задача не из лёгких, но следую этому руководству вы будете предупреждены о всевозможных подводных камнях.

### Непосредственно установка

1. Скачайте Android Studio [c официального сайта](https://developer.android.com/studio)
2. Удостовертесь, что имя пользователя в Windows и имя ПК не содержит пробелов и кириллицы
3. Устанавливайте Android Studio, выбирайте `Custom` настройки, `jre` оставляем не тронутым, а вот папку SDK укажите там, где желаете, чтоб хранились 4+ГБ **(путь не должен содержать кириллицу)**, предупреждения о конфликтах `NDK` игнорируем
4. Если у вас отсутствует ярлык, то перейдите по тому адресу, на который устанавливали Android Studio > bin > `studio64.exe` *часто приходится запускать от имени адмнистратора*
5. Если у вас имеется ошибка отдалённо напоминающая об отсутствии Java файлов — устанавливаем их [из официального сайта](https://www.java.com/ru/download/manual.jsp) независимо от того есть у вас Java или нет. **Устанавливайте автономную версию, как х64, так и обычную x32**
6. Заходим в переменные среды (ПКМ по Этот компьютер > Свойства > Дополнительные параметры > Переменные среды > Системные переменные > `PATH` и добавляем путь до вашего JRE, *к примеру `C:\Program Files\Java\jdk-14.0.2\bin`*
7. Перезагружаем ПК. *серьёзно, не пропускайте этот пункт*
8. Появляется окно с названием "Welcome to ~~hell~~ Android Studio. В правом углу кликаем по :gear:`Configure` и выбираем `SDK Manager`
**Если у вас произошла ошибка при загрузке файлов SDK** вверху будет `SDK Location` указываем любую пустую папку где угодно через edit. 

**Этот путь важно запомнить, т.к. он нам пригодиться ещё не раз**.

9. Выбираем желаемый SDK, в нашем случае это Android 9 (Pie).
10. После :warning:`Android SDK location should not...` и перед таблицей выбираем `SDK Tools`
11. Убеждаемся, что у нас имеется:

  - [x] Android SDK Build-Tools
  - [x] Android Emulator
  - [x] Android SDK Platform-Tools
  - [x] Google USB Driver
  - [x] Intel x86 Emulator Accelerator или Android Emulator Hypervision Driver for AMD processors в зависимости от вашего процессора
  Жмём Apply
  
  **ЕСЛИ HAXM В INTEL НЕ УСТАНОВИЛСЯ**
  - Обновите драйвера чипсета
  - Переустановите HAXM [здесь](https://github.com/intel/haxm). Releases > HAXM v.X.X.X > haxm_windwos_vX_X_X.zip
  - Перезапустите ПК

### AVD manager & ADB

Без тестировки приложения невозможна его разработка вовсе, поэтому разоберёмся с этим:

1. Сразу же заходим в BIOS и включаем виртуализацию. Для Intel процессоров это либо так и будет называться `Virtualization ...`, либо `VT-x`.
Для AMD процессоров это называется `SVM`, часто находится в CPU Advanced

**ЕСЛИ У ВАС НА ПК ЕСТЬ АНТИВИРУС**: оно может удалить пункт виртуализации из вашего BIOS, особенно Avast. [Отключение этой защиты](https://support.bluestacks.com/hc/en-us/articles/115004129743-How-can-I-configure-my-antivirus-software-to-improve-performance-of-BlueStacks-4-)

**ЕСЛИ У ВАС НЕТ ПУНКТОВ ВИРТУАЛИЗАЦИИ**: 

```
Win + R > cmd.exe
bcdedit /set hypervisorlaunchtype off
bcdedit /set nx AlwaysOn
```

2. Обратите внимание на `Hyper-V`, оно может вызывать серьёзные конфликты с AVD. Отключить его можно в `Программы и компоненты > Включение и отключение компонентов`
3. Подключите устройтво по USB и установите [драйвера для вашего Android-устройства](https://developer.android.com/studio/run/oem-usb#Drivers). Если вы убеждены, что у вас есть драйвера — тем более переустановите драйвера 
4. Убедитесь, что в Диспетчере устройств (Win + R > `devmgmt.msc`) есть `ADB interface`, если он находится в "Неизвестные устройства", то обновите драйвер. *Для Samsung необходимо установить драйвер, перезагрузиться, опять запустить установку драйвера, перезагрузиться*
5. [Скачайте platform-tools](https://developer.android.com/studio/releases/platform-tools) и распакуйте в %папка вашего SDK%\platform-tools\adb **по-умолчанию папки adb нет. Создайте её**
6. В настройках своего телефона зайдите в Настройки > "О телефоне" и нажмите на номер сборки 5-10 раз, пока не вылезет плашка `Вы теперь разработчик!`
Теперь вернитесь в настройки и зайдите в `{} Параметры разработчика`. Включите `Отладку по USB` (USB Debugging), согласитесь со всем.
7. Зайдите в папку-вашего-SDK\platform-tools\adb. Shift+ПКМ по пустому месту > Открыть окно Powershell (либо открыть окно команд)


**Для Powershell**: введите `cmd`
*далее как для powershell, так и для cmd*

Введите: `adb devices`
Убедитесь, что у вас подключенные устройства

8. Запустите Android Studio, нажмите на выпадающий список, где скорее всего будет No Device/Pixel 3a/что-то другое (рядом с :hammer: `app`) и выберете `AVD Manager`
9. Попробуйте запустить эмулятор Android
10. Вернитесь в студии и скомпилируйте проект (нажмите Run :arrow_forward:)

**Эти пункты магические :mage: и снимают порчу, когда "уже перепробовал всё, но ничего не работает"**

1. Заходим в переменные среды (ПКМ по Этот компьютер > Свойства > Дополнительные параметры > Переменные среды
2. Добавляем новую переменную в среду системы `ANDROID_SDK_ROOT` с значением в виде полного пути к вашей папке с SDK, *к примеру, `C:\Program Files\AndroidSDK\`* и `ANDROID_SDK_HOME` с значением полного пути к вашей папке с проектами *к примеру, `C:\androidProjects`* (если такой не имеется создаём и в дальнейшем сохраняем туда проекты)
3. Повторяем п. 8, но кликаем `Apperiance & Behavior` (либо, если проект открыть, то Files > Settings) и в внизу кликаем по `Path Variables`, кликаем по `+` и добавляем тоже, что и в предыдущем пункте
4. Создаём новый проект, убеждаемся в том, что выбрана **`Java`** и путь к проекту у нас тот же, что мы указали в п.14 в `ANDROID_SDK_HOME`
5. Первая инициализация будет долгой, запаситесь терпения, приготовьте чай/кофе за это время и по окончания сохраните и закройте проект

[Документация ADB](https://developer.android.com/studio/run/device#connect)
[Документация AVD](https://developer.android.com/studio/run/managing-avds)

P.S. Иногда виртуализация может выдавать BSOD `CLOCK_WATCHDOG_TIMEOUT` это бывает либо из-за 'хвостов' в системе ныне отсутствующих дисков, на которые ссылается AVD, либо из-за урезания частоты ЦП. В таком случае поднимите её, и отключите энергосберегающие и частотоурезающие технолоии `Intel C-STATE Tech Enhanced` и `Intel SpeedStep Technology`, также внимательно перечитайте пункты про `Hyper-V и HAXM`, `ADB и AVD` взаимосвязаны, поэтому не пропускайте ни аппаратной части, ни виртуальной в этом гайде.

Проверено практикой. Codergrad Team 2020
